@page "/agregarcliente"
@inject IGenericService<Cliente> ClienteService
@inject NavigationManager NavigationManager

<h3>Agregar un cliente</h3>

@if (cliente == null)
{
    <p><em>Cargando...</em></p>
}
else
{
    <EditForm Model="cliente" OnValidSubmit="GuardarCliente">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label for="Nombre">Nombre del Cliente</label>
            <InputText id="Nombre" class="form-control" @bind-Value="cliente.Nombre" />
        </div>

        <button type="submit" class="btn btn-primary">Guardar</button>
        <ValidationSummary />
    </EditForm>
}


@code {
    [SupplyParameterFromQuery]
    [Parameter]
    public int? IdClienteAgregado { get; set; }

    private Cliente cliente = new Cliente();

    protected override async Task OnInitializedAsync()
    {
        if (IdClienteAgregado.HasValue && IdClienteAgregado.Value != 0)
        {
            cliente = await ClienteService.GetByIdAsync(IdClienteAgregado.Value);
        }
        else
        {
            cliente = new Cliente();
        }
    }

    private async Task GuardarCliente()
    {
        if (cliente.Id == 0)
        {
            await ClienteService.AddAsync(cliente);
        }

        NavigationManager.NavigateTo("/clientes");
    }

}
